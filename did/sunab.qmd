---
title: "Sun and Abraham (2021) Estimator"
---

There are two [issues with the two-way fixed effects estimator](twfestaggered.qmd): forbidden comparisons and issues with weighting. Sun and Abraham (2021) proposes a new estimator that solves both of these issues.

-   First, the estimator divides all units into groups based on their initial treatment implementation.
-   Then, the estimator calculates dynamic ATT's separately for group. This captures heterogeneity of treatment between different initial treatment periods.
-   Then, these separate heterogeneous effects are manually aggregated together into one ATT using proper weighting based on how frequent each initial treatment period group appears in our sample.

Sun and Abraham estimate dynamic ATT's for each group by including interaction terms for each initial treatment period grouping and time period in a regression model.

$$
\begin{align}
Y_{it} = \sum\limits_g & \sum\limits_{k ≠ -1} \blue{\tau_{g, k}} \cdot 1\{i \in g\} \cdot 1\{t-g=k\} \\
+ & \ \alpha_i + \gamma_t + \b X_{it}'\b\beta + \eps_{it}
\end{align}
$$

::: small
The summations mean include one interaction for each $g$ (initial treatment year group), and each $t$ (time periods) within each $g$. The $1\{\}$ is an indicator function that takes a value of 1 if true, and 0 if false. $i \in g$ means unit $i$ initially recieved treatment in period $g$. $t-g$ represents the relative year of treatment, with the year treatment initiates is year 0. The first line interacts relative treatment period with the group indicator.
:::

The reason for $k ≠ -1$ is because time period -1 relative to treatment (so the year before treatment occurs) is set as the reference category. This is similar to dynamic treatment effects we saw previously.

This model will produce many coefficients $\tau_{g, t}$ (in fact, one for each post-treatment time period for each initial treatment year group). We can then properly weight each of them to create dynamic treatment effects. Sun and Abraham is primarily used to calculate dynamic treatment effects, but we can aggregate them into a single ATT if we need to.

Sun and Abraham's estimator is very similar to Wooldridge's [extended two-way fixed effects](etwfe.qmd) estimator. The three main differences are:

1.  Sun and Abraham can calculate dynamic treatment effects for every time period (both pre and post treatment). Wooldridge's can only calculate post-treatment. Thus, only Sun and Abraham can test for parallel trends.
2.  Sun and Abraham is more strict with covariates for parallel trends, while Wooldridge's allows for more flexibility and robustness to violations of parallel trends. This is because Wooldridge's estimator contains far more interactions with covariates.
3.  Wooldridge's estimator allows for non-linear models (poisson, logistic, etc.).

<br />

To implement this estimator, we will need the **fixest** package:

```{r, eval = F}
library(fixest)
```

We implement Sun and Abraham's estimator as follows:

```{r, eval = F}
model <- feols(Y ~ sunab(initial_treat_year, period) | unit + period,
               data = my_data,
               vcov = ~unit)
iplot(model)
```
