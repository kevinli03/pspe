---
title: "Sun and Abraham (2021) Estimator"
---

There are two [issues with the two-way fixed effects estimator](twfestaggered.qmd): forbidden comparisons and issues with weighting. Sun and Abraham (2021) proposes a new estimator that solves both of these issues.

-   First, the estimator divides all units into groups based on their initial treatment implementation.
-   Then, the estimator calculates dynamic ATT's separately for group. This captures heterogeneity of treatment between different initial treatment periods.
-   Then, these separate heterogeneous effects are manually aggregated together into one ATT using proper weighting based on how frequent each initial treatment period group appears in our sample.

Sun and Abraham estimate dynamic ATT's for each group by including interaction terms for each initial treatment period grouping and time period in a regression model.

$$
\Y = \underbrace{\unit + \time}_{\text{fixed effecs}} +\underbrace{\blue{\tau} \left( \text{group} \cdot \text{rel.time} \right)}_{\text{interact for heterogeneity}} +  \beta \ \cov + \eps
$$

::: small
$\text{group}$ is a categorical variable that indicates what initial treatment period group unit $i$ belongs to. $\text{rel.time}$ is a categorical variable that describes unit $i$ at time $t$, and how many periods away from the initial treatment period of that unit $i$ is. $\text{covariates}$ is a vector of values for all covariates for a specific unit $i$ at period $t$. Essentially, thisinteracts group with relative treatment time.
:::

This model will produce many coefficients $\blue\tau$ (in fact, one for each post-treatment time period for each initial treatment year group). We can then properly weight each of them to create dynamic treatment effects. Sun and Abraham is primarily used to calculate dynamic treatment effects, but we can aggregate them into a single ATT if we need to.

Sun and Abraham's estimator is very similar to Wooldridge's [extended two-way fixed effects](etwfe.qmd) estimator. The three main differences are:

1.  Sun and Abraham can calculate dynamic treatment effects for every time period (both pre and post treatment). Wooldridge's can only calculate post-treatment. Thus, only Sun and Abraham can test for parallel trends.
2.  Sun and Abraham is more strict with covariates for parallel trends, while Wooldridge's allows for more flexibility and robustness to violations of parallel trends. This is because Wooldridge's estimator contains far more interactions with covariates.
3.  Wooldridge's estimator allows for non-linear models (poisson, logistic, etc.).

<br />

To implement this estimator, we will need the **fixest** package:

```{r, eval = F}
library(fixest)
```

We implement Sun and Abraham's estimator as follows:

```{r, eval = F}
model <- feols(outcome ~ sunab(initial_treat_year, time) + covariate1 + covariate2 | unit + time,
               data = my_data,
               vcov = ~unit)
iplot(model)
```
