---
title: "Wooldridge (2021) Extended Two-Way Fixed Effects"
---

There are two [issues with the two-way fixed effects estimator](twfestaggered.qmd): forbidden comparisons and issues with weighting. Wooldridge (2021, 2023) proposes a new estimator, the extended two-way fixed effects (ETWFE) estimator, that solves both of these issues.

-   First, the ETWFE estimator estimates all possible heterogeneous effects separately, using only valid comparisons, solving the forbidden comparison problem.
-   Then, these separate heterogeneous effects are manually aggregated together into one ATT using proper weighting based on how frequent each heterogeneous treatment effect occurs in our sample.

Wooldridge proposes to estimate all of the possible heterogenous treatment effects by simply adding a ton of interaction terms to the TWFE estimator to account for every possible heterogeneity. The two main forms of heterogeneity are heterogeneity between different initial treatment years, and heterogeneity between different levels of confounders.

$$
\begin{align}
\text{outcome}_{it} = & \ \blue{\tau_{\text{group}, t}} \cdot \text{group}_i \cdot \text{treatment}_{it} \cdot \text{period}_t \\
& + \blue{\tau_{\text{group},t, \text{covariates}}} \cdot \text{group}_i \cdot \text{treatment}_{it} \cdot \text{period}_t \cdot \b{\text{covariates}}_{\ it} \\
& +  \text{unit}_i + \text{period}_t + \b{\text{covariates}}_{\ it} \b\beta + \eps_{it}
\end{align}
$$

::: small
$\text{group}_i$ is a categorical variable that indicates what initial treatment period group unit $i$ belongs to. $\text{period}_t$ is a categorical variable that indicates the different time periods. $\b{\text{covariates}}_{\ it}$ is a vector of values for all covariates for a specific unit $i$ at period $t$. Essentially, the first line captures a interaction between groups, treatment, and time, and the second line captures an interaction between groups, treatment, time, and covariates.
:::

This model will produce many coefficients $\blue{\tau_{\text{group}, t}}$ and $\blue{\tau_{\text{group}, t, \text{covariates}}}$ that capture different heterogeneity in treatment effects. To obtain a single ATT, we will want to aggregate them together in a weighted average.

We can also aggregate them in terms of relative years to initial treatment, which allows us to compute dynamic treatment effects. However, this estimator can only compute post-treatment dynamic treatment effects.

Wooldridge's 2023 paper also extends this framework to work with logistic regression, poisson regression, and negative binomial regression, which is useful when we deal with non-continuous outcome variables.

Wooldridge's extended two-way fixed effects estimator is very similar to [Sun and Abraham's](sunab.qmd) estimator. The three main differences are:

1.  Sun and Abraham can calculate dynamic treatment effects for every time period (both pre and post treatment). Wooldridge's can only calculate post-treatment. Thus, only Sun and Abraham can test for parallel trends.
2.  Sun and Abraham is more strict with covariates for parallel trends, while Wooldridge's allows for more flexibility and robustness to violations of parallel trends. This is because Wooldridge's estimator contains far more interactions with covariates.
3.  Wooldridge's estimator allows for non-linear models (poisson, logistic, etc.).

<br />

To implement extended two-way fixed effects, we will need the **etwfe** package:

```{r, eval = F}
library(etwfe)
```

To estimate all the group-time ATTs, we do the following:

```{r, eval = F}
model <- etwfe(fml = Y ~ X1 + X2 + X3, #if no controls, put 0 after ~
              tvar = period, #time period variable
              gvar = initial_treat, #initial period of treatment for unit
              data = my_data,
              vcov = ~unit, # cluster se by unit
              family = NULL) 
```

::: small
You can delete the family argument if you are just using a standard linear model. You can also replace NULL with "logit", "poisson", and "negbin".
:::

We can then aggregate our group-time ATT's. To obtain one single ATT, we can use the following code:

```{r, eval = F}
emfx(model)
```

We can also get dynamic ATT's for post-treatment periods:

```{r, eval = F}
dynamic <- emfx(model, type = "event")
plot(dynamic)
```
